{% extends "base.html" %}

{% block title %}Dashboard - Skanda Credit & Billing{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block header_actions %}
<div class="d-flex align-items-center gap-3">
    <div class="text-end d-none d-sm-block">
        <div class="text-xs text-muted text-uppercase fw-semibold">Current Tenant</div>
        <div class="fw-medium text-slate-800">Skanda Enterprises</div>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        {% if current_user.role == 'ORGANISER' %}
        <div class="alert alert-info border-0 shadow-sm d-flex align-items-center">
            <i class="bi bi-info-circle-fill me-3 fs-4"></i> 
            <div>
                <strong>Note:</strong> You can only view bills that have been authorized by the Admin.
            </div>
        </div>
        {% elif current_user.role == 'SALESMAN' %}
        <div class="alert alert-success border-0 shadow-sm d-flex align-items-center">
            <i class="bi bi-check-circle-fill me-3 fs-4"></i> 
            <div>
                <strong>Welcome Salesman!</strong> You can create bills and register payments.
            </div>
        </div>
        {% elif current_user.role == 'DELIVERY' %}
        <div class="alert alert-warning border-0 shadow-sm d-flex align-items-center">
            <i class="bi bi-truck me-3 fs-4"></i> 
            <div>
                <strong>Welcome Delivery!</strong> You can manage delivery orders.
            </div>
        </div>
        {% endif %}
    </div>
</div>

<div class="row g-4 mb-5">
    <!-- Vendors Card -->
    <div class="col-md-4">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="stats-card">
                    <div class="stats-info">
                        <h6>Total Vendors</h6>
                        <h3>{{ stats.vendor_count }}</h3>
                        <a href="{{ url_for('vendor.list') }}" class="btn btn-sm btn-outline-primary mt-3">
                            View All <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="stats-icon bg-primary-50 text-primary-600">
                        <i class="bi bi-people-fill"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bills Card -->
    <div class="col-md-4">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="stats-card">
                    <div class="stats-info">
                        <h6>Total Bills</h6>
                        <h3>{{ stats.bill_count }}</h3>
                        <a href="{{ url_for('bill.list') }}" class="btn btn-sm btn-outline-primary mt-3">
                            View All <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="stats-icon bg-green-50 text-success">
                        <i class="bi bi-receipt-cutoff"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Outstanding Card -->
    <div class="col-md-4">
        <div class="card h-100 border-0 shadow-sm">
            <div class="card-body p-0">
                <div class="stats-card">
                    <div class="stats-info">
                        <h6>Outstanding Amount</h6>
                        <h3>â‚¹{{ "%.2f"|format(stats.outstanding) }}</h3>
                        <a href="{{ url_for('report.outstanding') }}" class="btn btn-sm btn-outline-primary mt-3">
                            View Report <i class="bi bi-arrow-right ms-1"></i>
                        </a>
                    </div>
                    <div class="stats-icon bg-yellow-50 text-warning">
                        <i class="bi bi-cash-coin"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white border-bottom py-3">
                <h5 class="mb-0 text-slate-800"><i class="bi bi-lightning-charge me-2 text-warning"></i> Quick Actions</h5>
            </div>
            <div class="card-body p-4">
                <div class="d-flex flex-wrap gap-3">
                    {% if has_permission('create_vendor') %}
                    <a href="{{ url_for('vendor.create') }}" class="btn btn-primary px-4 py-2">
                        <i class="bi bi-plus-circle me-2"></i> Add Vendor
                    </a>
                    {% endif %}
                    {% if has_permission('create_bill') %}
                    <a href="{{ url_for('bill.create') }}" class="btn btn-success px-4 py-2 text-white">
                        <i class="bi bi-receipt me-2"></i> Create Bill
                    </a>
                    {% endif %}
                    {% if has_permission('create_credit') %}
                    <a href="{{ url_for('credit.create') }}" class="btn btn-info px-4 py-2 text-white">
                        <i class="bi bi-cash-coin me-2"></i> Add Credit Entry
                    </a>
                    {% endif %}
                    {% if has_permission('create_delivery') %}
                    <a href="{{ url_for('delivery.create') }}" class="btn btn-warning px-4 py-2 text-white">
                        <i class="bi bi-truck me-2"></i> Create Delivery
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
